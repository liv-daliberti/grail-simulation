# Prompt Builder Package

The `prompt_builder` package is responsible for transforming a cleaned
GRAIL interaction row into human-readable profile sentences and the
chat-style prompt consumed by training agents and evaluation baselines.

## Responsibilities

- Merge survey demographics (`selected_survey_row`) with session
  metadata to produce narrative profile sentences via
  `render_profile()`.
- Assemble the full prompt (`build_user_prompt()`) including profile,
  history, current video, and slate options.
- Provide reusable helpers for text cleaning, boolean parsing, and
  structured formatting so callers can share rendering logic.

## Conventions & Rules

- Modules should remain dependency-light. Optional libraries (e.g.
  `pyarrow`, `pandas`) must be guarded with defensive imports.
- Keep exception handling narrow (avoid blanket `except Exception`)
  to ensure linting and debugging clarity.
- All exported functions require docstrings; internal helpers can
  remain private (`_helper_name`) when not intended for reuse.
- The package is tested via `tests/test_prompt_builder_package.py`; add
  additional fixtures if you extend the data schema.
- Documentation is generated by Sphinx (`docs/api/prompt_builder.rst`).
  Update docstrings when changing behaviour so the published reference
  stays accurate.

## Limitations

- Input rows must already be cleaned: missing mandatory fields (e.g.
  slate items) result in empty sections rather than validation errors.
- The profile renderer focuses on survey-available columns; introducing
  new attributes requires updating `profiles.py` alongside the constants
  in `clean_data`.
- The prompt utilities assume a YouTube-style environment (options,
  history, etc.); adapting to other domains may require extending the
  module structure.
